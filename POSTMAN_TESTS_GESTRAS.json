{
  "info": {
    "name": "Comuctiva - Gestión de Transporte Agrícola",
    "_postman_id": "comuctiva-gestras-2024",
    "description": "Colección completa para probar endpoints de vehículos, cotizaciones y configuración de fletes",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Autenticación",
      "item": [
        {
          "name": "Login - Obtener Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('token', jsonData.token);",
                  "    pm.environment.set('token', jsonData.token);",
                  "    console.log('Token guardado: ' + jsonData.token);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"correo\": \"admin@comuctiva.com\",\n  \"contrasena\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/usuario/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "usuario", "login"]
            },
            "description": "Obtener token JWT para autenticación. Ajusta correo y contraseña según tu usuario administrador."
          },
          "response": []
        }
      ]
    },
    {
      "name": "2. Configuración de Fletes",
      "item": [
        {
          "name": "GET - Obtener Configuración Tarifas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/fletes/config",
              "host": ["{{baseUrl}}"],
              "path": ["api", "fletes", "config"]
            },
            "description": "Obtiene la configuración de tarifas por tipo de vehículo (FURGON, VAN) y reglas globales."
          },
          "response": []
        }
      ]
    },
    {
      "name": "3. Vehículos",
      "item": [
        {
          "name": "GET - Listar Todos los Vehículos",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/vehiculos",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehiculos"]
            },
            "description": "Lista todos los vehículos de la flota con sus KPIs (viajes/mes, ingresos/mes)."
          },
          "response": []
        },
        {
          "name": "GET - Obtener Vehículo por ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/vehiculos/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehiculos", "1"]
            },
            "description": "Obtiene los detalles de un vehículo específico por su ID."
          },
          "response": []
        },
        {
          "name": "POST - Crear Nuevo Vehículo",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tipo\": \"VAN\",\n  \"nombre\": \"Van Test Agrícola\",\n  \"placa\": \"TST999\",\n  \"conductor\": \"Test Driver\",\n  \"capacidadKg\": 1500,\n  \"estado\": \"DISPONIBLE\",\n  \"mantenimiento\": false,\n  \"ubicacion\": \"Bogotá - Centro\",\n  \"viajesMes\": 0,\n  \"ingresosMes\": 0,\n  \"transportadoraId\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/vehiculos",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehiculos"]
            },
            "description": "Crea un nuevo vehículo en la flota. Requiere rol Administrador."
          },
          "response": []
        },
        {
          "name": "PUT - Actualizar Vehículo",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tipo\": \"VAN\",\n  \"nombre\": \"Van Express Modificada\",\n  \"placa\": \"AGR006\",\n  \"conductor\": \"Luis Hernández\",\n  \"capacidadKg\": 1600,\n  \"estado\": \"DISPONIBLE\",\n  \"mantenimiento\": false,\n  \"ubicacion\": \"Bogotá - Norte\",\n  \"viajesMes\": 42,\n  \"ingresosMes\": 10200000,\n  \"transportadoraId\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/vehiculos/6",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehiculos", "6"]
            },
            "description": "Actualiza todos los datos de un vehículo existente."
          },
          "response": []
        },
        {
          "name": "PATCH - Cambiar Estado Vehículo",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"MANTENIMIENTO\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/vehiculos/1/estado",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehiculos", "1", "estado"]
            },
            "description": "Cambia únicamente el estado de un vehículo (DISPONIBLE, EN_RUTA, MANTENIMIENTO)."
          },
          "response": []
        },
        {
          "name": "DELETE - Eliminar Vehículo",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/vehiculos/7",
              "host": ["{{baseUrl}}"],
              "path": ["api", "vehiculos", "7"]
            },
            "description": "Elimina un vehículo de la flota. Requiere rol Administrador."
          },
          "response": []
        }
      ]
    },
    {
      "name": "4. Cotizaciones",
      "item": [
        {
          "name": "GET - Listar Todas las Cotizaciones",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones"]
            },
            "description": "Lista todas las cotizaciones sin filtros."
          },
          "response": []
        },
        {
          "name": "GET - Filtrar Cotizaciones por Fechas",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones?from=2025-11-01&to=2025-11-30",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones"],
              "query": [
                {
                  "key": "from",
                  "value": "2025-11-01"
                },
                {
                  "key": "to",
                  "value": "2025-11-30"
                }
              ]
            },
            "description": "Filtra cotizaciones por rango de fechas (formato: YYYY-MM-DD)."
          },
          "response": []
        },
        {
          "name": "GET - Filtrar por Estado",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones?estado=COMPLETADO",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones"],
              "query": [
                {
                  "key": "estado",
                  "value": "COMPLETADO"
                }
              ]
            },
            "description": "Filtra cotizaciones por estado: PENDIENTE, EN_PROCESO, COMPLETADO, RECHAZADO."
          },
          "response": []
        },
        {
          "name": "GET - Obtener Cotización por ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones/1",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones", "1"]
            },
            "description": "Obtiene los detalles completos de una cotización, incluyendo breakdown de costos."
          },
          "response": []
        },
        {
          "name": "POST - Calcular Cotización (sin guardar)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"producto\": \"Banano Premium - 100 cajas\",\n  \"pesoKg\": 2000,\n  \"tipoVehiculo\": \"FURGON\",\n  \"origen\": \"Urabá\",\n  \"destino\": \"Corabastos Bogotá\",\n  \"distanciaKm\": 780\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones/calcular",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones", "calcular"]
            },
            "description": "Calcula una cotización sin persistirla en BD. Devuelve breakdown completo (tarifa base, costo km, seguro, IVA, peaje, total)."
          },
          "response": []
        },
        {
          "name": "POST - Crear Cotización",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"producto\": \"Café en Grano - 50 bultos\",\n  \"pesoKg\": 1250,\n  \"tipoVehiculo\": \"VAN\",\n  \"origen\": \"Armenia\",\n  \"destino\": \"Bogotá\",\n  \"distanciaKm\": 290,\n  \"estado\": \"PENDIENTE\",\n  \"transportadoraId\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones"]
            },
            "description": "Crea y guarda una nueva cotización en BD. El cálculo de costos se hace automáticamente."
          },
          "response": []
        },
        {
          "name": "PATCH - Actualizar Estado Cotización",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"EN_PROCESO\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones/5/estado",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones", "5", "estado"]
            },
            "description": "Cambia el estado de una cotización existente."
          },
          "response": []
        },
        {
          "name": "PATCH - Rechazar Cotización",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"RECHAZADO\",\n  \"motivoRechazo\": \"Producto no disponible en origen para la fecha solicitada\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones/8/estado",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones", "8", "estado"]
            },
            "description": "Rechaza una cotización indicando el motivo."
          },
          "response": []
        }
      ]
    },
    {
      "name": "5. Tests de Integración",
      "item": [
        {
          "name": "Test Completo - Crear Vehículo y Cotización",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has id', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"producto\": \"Papa Pastusa - Test\",\n  \"pesoKg\": 800,\n  \"tipoVehiculo\": \"FURGON\",\n  \"origen\": \"Ventaquemada\",\n  \"destino\": \"Corabastos\",\n  \"distanciaKm\": 168,\n  \"estado\": \"PENDIENTE\",\n  \"transportadoraId\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/cotizaciones",
              "host": ["{{baseUrl}}"],
              "path": ["api", "cotizaciones"]
            }
          },
          "response": []
        }
      ]
    }
  ]
}
